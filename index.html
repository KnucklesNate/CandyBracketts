<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sweet Showdown: Chocolate vs Fruity</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #111831;
      --accent-choc: #8b5a2b;
      --accent-fruit: #c62828;
      --accent-final: #2e7d32;
      --line: #26304f;
      --text: #e8eefc;
      --muted: #a9b4d6;
      --card: #141c38;
      --win: #1f2a52;
      --shadow: 0 10px 22px rgba(0,0,0,0.35);
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text); background: radial-gradient(1200px 800px at 20% -10%, #172147 0%, var(--bg) 55%) fixed;
    }
    header {
      text-align: center; padding: 20px 12px 8px; position: sticky; top: 0; background: linear-gradient(180deg, rgba(11,16,32,0.95), rgba(11,16,32,0.6) 70%, rgba(11,16,32,0)); backdrop-filter: blur(6px); z-index: 5; border-bottom: 1px solid rgba(168, 182, 221, 0.08);
    }
    header h1 { margin: 0; font-size: clamp(1.2rem, 2.4vw, 2rem); letter-spacing: 0.4px; }
    .sub { color: var(--muted); font-size: 0.95rem; margin-top: 6px; }

    .toolbar {
      display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap; margin: 14px 0 4px;
    }
    button, .pill {
      background: var(--panel); color: var(--text); border: 1px solid rgba(168, 182, 221, 0.18);
      padding: 10px 14px; border-radius: 12px; cursor: pointer; box-shadow: var(--shadow); transition: transform .04s ease, background .2s;
    }
    button:hover { background: #1a2244; }
    button:active { transform: translateY(1px); }

    .container {
      max-width: 1250px; margin: 0 auto; padding: 12px 10px 40px;
    }

    .legend { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap: wrap; margin-bottom: 12px; }
    .legend .chip { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius: 999px; background: var(--panel); border: 1px solid rgba(168, 182, 221, 0.16); }
    .dot { width: 12px; height: 12px; border-radius: 50%; display:inline-block; }
    .dot.choc { background: var(--accent-choc); }
    .dot.fruit { background: var(--accent-fruit); }
    .dot.final { background: var(--accent-final); }

    .bracket {
      display: grid; grid-template-columns: 1fr auto 1fr; gap: 18px; align-items: stretch;
    }

    .side { display: grid; grid-template-columns: repeat(4, minmax(170px, 1fr)); gap: 14px; }
    .round { display:flex; flex-direction: column; gap: 12px; }

    .round-title { text-align:center; color: var(--muted); font-size: 0.88rem; margin-bottom: 6px; }

    .match { background: var(--card); border: 1px solid rgba(168,182,221,0.14); border-radius: 14px; box-shadow: var(--shadow); padding: 8px; position: relative; }
    .pair { display:flex; flex-direction: column; gap: 6px; }

    .slot { display:flex; align-items:center; gap: 8px; border: 1px solid var(--line); padding: 10px; border-radius: 10px; cursor: pointer; transition: background .18s, border-color .18s, transform .04s; }
    .slot:hover { background: #0f1836; border-color: #33406b; }
    .slot.disabled { opacity: 0.5; cursor: not-allowed; }

    .seed { background: rgba(168,182,221,0.14); border: 1px solid rgba(168,182,221,0.22); color: var(--muted); font-weight: 600; font-size: 0.8rem; border-radius: 8px; padding: 2px 7px; }
    .name { flex: 1; font-weight: 600; letter-spacing: 0.2px; }

    .slot.winner { background: var(--win); border-color: #3a4a86; box-shadow: inset 0 0 0 1px rgba(168,182,221,0.18); }

    .center {
      display:flex; flex-direction: column; justify-content: center; gap: 10px; min-width: 240px;
    }
    .final-card { background: linear-gradient(180deg, rgba(46,125,50,0.18), rgba(20,28,56,0.86)); border: 1px solid rgba(62, 143, 66, 0.5); border-radius: 16px; padding: 14px; box-shadow: var(--shadow);
    }

    .final-title { text-align:center; font-weight: 700; color: #d6f5d8; margin-bottom: 6px; }

    .final-match .slot { background: #10273f; border-color: #295d91; }
    .final-match .slot.winner { background: #13314f; border-color: #3b79b9; }

    .champion { text-align:center; padding: 12px; border-radius: 14px; border: 1px dashed rgba(168,182,221,0.28); min-height: 54px; display:flex; align-items:center; justify-content:center; color: #eaf7ec; background: rgba(26, 109, 40, 0.12); }

    .footer-note { color: var(--muted); text-align:center; margin-top: 16px; font-size: 0.85rem; }

    @media (max-width: 1100px) {
      .bracket { grid-template-columns: 1fr; }
      .center { order: -1; }
      .side { grid-template-columns: repeat(2, minmax(170px, 1fr)); }
    }

    @media print {
      body { background: #fff; color: #000; }
      header { position: static; background: #fff; border: none; }
      button { display: none; }
      .match, .slot { box-shadow: none !important; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Sweet Showdown: Chocolate vs Fruity — Interactive 32-Candy Bracket</h1>
    <div class="sub">Click a candy to advance it through the rounds. Chocolate left, Fruity right. Final in the middle.</div>

    <div class="toolbar">
      <button id="resetBtn" title="Clear all picks">Reset</button>
      <button id="fillRandomBtn" title="Randomly fill winners">Randomize Winners</button>
      <button id="shareBtn" title="Copy a sharable bracket code">Copy Share Code</button>
      <button id="reloadBtn" title="Reload external data (if using ?data=)">Reload Data</button>
      <span class="pill" id="status">Ready</span>
    </div>

    <div class="legend">
      <span class="chip"><span class="dot choc"></span> Chocolate Division</span>
      <span class="chip"><span class="dot fruit"></span> Fruity Division</span>
      <span class="chip"><span class="dot final"></span> Grand Final</span>
    </div>
  </header>

  <div class="container">
    <div class="bracket">
      <section class="side" id="leftSide" aria-label="Chocolate Division"></section>
      <section class="center">
        <div class="final-card">
          <div class="final-title">Grand Final</div>
          <div class="match final-match" id="finalMatch">
            <div class="round-title">Chocolate Champion vs Fruity Champion</div>
            <div class="pair">
              <div class="slot" data-side="final" data-slot="0"><span class="seed">C</span><span class="name">—</span></div>
              <div class="slot" data-side="final" data-slot="1"><span class="seed">F</span><span class="name">—</span></div>
            </div>
          </div>
          <div class="champion" id="champion">Pick finalists to crown a champion</div>
        </div>
      </section>
      <section class="side" id="rightSide" aria-label="Fruity Division"></section>
    </div>

    <div class="footer-note">Tip: Use “Randomize Winners” to simulate a quick tournament, or click “Copy Share Code” to save/restore your bracket.</div>
  </div>

  <script>
    // --- Configurable: external JSON source via URL param ?data= and optional ?autorefresh=seconds
    // If provided, the page will fetch a public JSON (e.g., a GitHub Gist raw URL) and hydrate the bracket state.

    // --- Seeds ---
    const chocolateSeeds = [
      { seed: 1, name: "Reese’s Peanut Butter Cups" },
      { seed: 2, name: "Snickers" },
      { seed: 3, name: "Kit Kat" },
      { seed: 4, name: "Twix" },
      { seed: 5, name: "Hershey’s Milk Chocolate Bar" },
      { seed: 6, name: "M&M’s (Plain)" },
      { seed: 7, name: "Milky Way" },
      { seed: 8, name: "Butterfinger" },
      { seed: 9, name: "3 Musketeers" },
      { seed: 10, name: "Dove Chocolate" },
      { seed: 11, name: "M&M’s (Peanut)" },
      { seed: 12, name: "Crunch Bar" },
      { seed: 13, name: "Almond Joy" },
      { seed: 14, name: "Baby Ruth" },
      { seed: 15, name: "Hershey’s Cookies ’n’ Creme" },
      { seed: 16, name: "Whoppers" }
    ];

    const fruitySeeds = [
      { seed: 1, name: "Skittles" },
      { seed: 2, name: "Starburst" },
      { seed: 3, name: "Sour Patch Kids" },
      { seed: 4, name: "Swedish Fish" },
      { seed: 5, name: "Jolly Ranchers" },
      { seed: 6, name: "Laffy Taffy" },
      { seed: 7, name: "Airheads" },
      { seed: 8, name: "Mike and Ike" },
      { seed: 9, name: "Nerds" },
      { seed: 10, name: "Lifesavers Gummies" },
      { seed: 11, name: "Twizzlers" },
      { seed: 12, name: "Hi-Chew" },
      { seed: 13, name: "Smarties" },
      { seed: 14, name: "Haribo Gummy Bears" },
      { seed: 15, name: "Runts" },
      { seed: 16, name: "Warheads" }
    ];

    // Standard 16-team bracket pairing order by seed:
    const seedPairOrder = [1,16, 8,9, 5,12, 4,13, 6,11, 3,14, 7,10, 2,15];

    function orderByPairing(seeds) {
      const bySeed = new Map(seeds.map(s => [s.seed, s]));
      const ordered = [];
      for (let i = 0; i < seedPairOrder.length; i += 2) {
        ordered.push([ bySeed.get(seedPairOrder[i]), bySeed.get(seedPairOrder[i+1]) ]);
      }
      return ordered; // array of [a,b] pairs for Round 1
    }

    function nextRoundFromWinners(round) {
      const next = [];
      for (let i = 0; i < round.length; i += 2) {
        next.push([ null, null ]); // placeholder slots
      }
      return next;
    }

    const state = {
      left: { rounds: [] },
      right: { rounds: [] },
      final: [ null, null ],
      champion: null
    };

    function initState() {
      state.left.rounds = [];
      state.right.rounds = [];
      state.final = [null, null];
      state.champion = null;

      // Round 1
      const leftR1 = orderByPairing(chocolateSeeds);
      const rightR1 = orderByPairing(fruitySeeds);

      state.left.rounds.push(leftR1);
      state.right.rounds.push(rightR1);

      // Rounds 2..4
      for (let i = 0; i < 3; i++) {
        state.left.rounds.push(nextRoundFromWinners(state.left.rounds[i]));
        state.right.rounds.push(nextRoundFromWinners(state.right.rounds[i]));
      }
    }

    function $(q, root=document) { return root.querySelector(q); }
    function $all(q, root=document) { return Array.from(root.querySelectorAll(q)); }

    const leftSideEl = $('#leftSide');
    const rightSideEl = $('#rightSide');
    const championEl = $('#champion');
    const statusEl = $('#status');

    function render() {
      leftSideEl.innerHTML = '';
      rightSideEl.innerHTML = '';

      const titles = ['Round of 16','Quarterfinals','Semifinals','Division Final'];

      // Render left side (Chocolate)
      state.left.rounds.forEach((round, rIdx) => {
        const col = document.createElement('div');
        col.className = 'round';
        const t = document.createElement('div');
        t.className = 'round-title';
        t.textContent = titles[rIdx] + ' — Chocolate';
        t.style.color = 'var(--muted)';
        col.appendChild(t);

        round.forEach((match, mIdx) => {
          const matchEl = document.createElement('div');
          matchEl.className = 'match';
          matchEl.dataset.side = 'left';
          matchEl.dataset.round = rIdx;
          matchEl.dataset.match = mIdx;

          const pair = document.createElement('div');
          pair.className = 'pair';

          match.forEach((slot, sIdx) => {
            const slotEl = slotElement(slot, 'left', rIdx, mIdx, sIdx);
            pair.appendChild(slotEl);
          });

          matchEl.appendChild(pair);
          col.appendChild(matchEl);
        });
        leftSideEl.appendChild(col);
      });

      // Render right side (Fruity)
      state.right.rounds.forEach((round, rIdx) => {
        const col = document.createElement('div');
        col.className = 'round';
        const t = document.createElement('div');
        t.className = 'round-title';
        t.textContent = titles[rIdx] + ' — Fruity';
        t.style.color = 'var(--muted)';
        col.appendChild(t);

        round.forEach((match, mIdx) => {
          const matchEl = document.createElement('div');
          matchEl.className = 'match';
          matchEl.dataset.side = 'right';
          matchEl.dataset.round = rIdx;
          matchEl.dataset.match = mIdx;

          const pair = document.createElement('div');
          pair.className = 'pair';

          match.forEach((slot, sIdx) => {
            const slotEl = slotElement(slot, 'right', rIdx, mIdx, sIdx);
            pair.appendChild(slotEl);
          });

          matchEl.appendChild(pair);
          col.appendChild(matchEl);
        });
        rightSideEl.appendChild(col);
      });

      // Render final slots
      const finalSlots = $all('.final-match .slot');
      finalSlots[0].querySelector('.name').textContent = state.final[0]?.name ?? '—';
      finalSlots[1].querySelector('.name').textContent = state.final[1]?.name ?? '—';

      finalSlots.forEach((el, idx) => {
        el.onclick = () => {
          if (!state.final[0] || !state.final[1]) return;
          const winner = state.final[idx];
          state.champion = winner;
          championEl.textContent = `Champion: ${winner.name}`;
          status(`Crowned: ${winner.name}`);
          finalSlots.forEach(s => s.classList.remove('winner'));
          el.classList.add('winner');
          saveToHash();
        };
      });

      championEl.textContent = state.champion ? `Champion: ${state.champion.name}` : 'Pick finalists to crown a champion';
    }

    function slotElement(slot, side, roundIdx, matchIdx, slotIdx) {
      const el = document.createElement('div');
      el.className = 'slot';
      el.dataset.side = side;
      el.dataset.round = roundIdx;
      el.dataset.match = matchIdx;
      el.dataset.slot = slotIdx;

      const seed = document.createElement('span');
      seed.className = 'seed'; seed.textContent = slot?.seed ?? '—';
      const name = document.createElement('span');
      name.className = 'name'; name.textContent = slot?.name ?? '—';

      el.append(seed, name);

      if (!slot) el.classList.add('disabled');

      el.onclick = () => {
        if (!slot) return;
        chooseWinner(side, roundIdx, matchIdx, slotIdx);
        saveToHash();
      };

      return el;
    }

    function chooseWinner(side, roundIdx, matchIdx, slotIdx) {
      const branch = state[side];
      const match = branch.rounds[roundIdx][matchIdx];
      const winner = match[slotIdx];

      const matchEl = document.querySelector(`.match[data-side="${side}"][data-round="${roundIdx}"][data-match="${matchIdx}"]`);
      if (matchEl) {
        $all('.slot', matchEl).forEach(s => s.classList.remove('winner'));
        const slotEl = matchEl.querySelector(`.slot[data-slot="${slotIdx}"]`);
        slotEl?.classList.add('winner');
      }

      if (roundIdx + 1 < branch.rounds.length) {
        const nextIdx = Math.floor(matchIdx / 2);
        const pos = matchIdx % 2;
        branch.rounds[roundIdx + 1][nextIdx][pos] = winner;
      }

      const lastRoundIdx = branch.rounds.length - 1;
      if (roundIdx === lastRoundIdx) {
        state.final[ side === 'left' ? 0 : 1 ] = winner;
        state.champion = null;
        $all('.final-match .slot').forEach(s => s.classList.remove('winner'));
      }

      render();
      status(`${winner.name} advances`);
    }

    function status(msg) {
      statusEl.textContent = msg;
      clearTimeout(statusEl._t);
      statusEl._t = setTimeout(() => statusEl.textContent = 'Ready', 2000);
    }

    function resetBracket() {
      initState();
      render();
      saveToHash();
      status('Bracket reset');
    }

    function randomAdvanceSide(sideKey) {
      const branch = state[sideKey];
      for (let r = 0; r < branch.rounds.length; r++) {
        const round = branch.rounds[r];
        for (let m = 0; m < round.length; m++) {
          const [a, b] = round[m];
          if (!a || !b) continue;
          const winnerIdx = Math.random() < 0.5 ? 0 : 1;
          const winner = winnerIdx === 0 ? a : b;
          if (r < branch.rounds.length - 1) {
            const nextIdx = Math.floor(m / 2);
            const pos = m % 2;
            branch.rounds[r + 1][nextIdx][pos] = winner;
          } else {
            state.final[ sideKey === 'left' ? 0 : 1 ] = winner;
          }
        }
      }
    }

    function randomizeAll() {
      initState();
      randomAdvanceSide('left');
      randomAdvanceSide('right');
      if (state.final[0] && state.final[1]) {
        state.champion = Math.random() < 0.5 ? state.final[0] : state.final[1];
      }
      render();
      saveToHash();
      status('Random bracket generated');
    }

    // --- Share / Restore via URL hash ---
    function encodeState() {
      function mapSide(branch) {
        return branch.rounds.map(r => r.map(([a,b]) => [a?.seed ?? 0, b?.seed ?? 0]));
      }
      const payload = { L: mapSide(state.left), R: mapSide(state.right), F: [ state.final[0]?.seed ?? 0, state.final[1]?.seed ?? 0 ], C: state.champion?.seed ?? 0 };
      return btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
    }

    function decodeState(str) {
      try {
        const obj = JSON.parse(decodeURIComponent(escape(atob(str))));
        applyPayload(obj);
        return true;
      } catch(e) {
        console.warn('Failed to decode state', e);
        return false;
      }
    }

    function applyPayload(obj) {
      function bySeedMap(arr) { return new Map(arr.map(x => [x.seed, x])); }
      const Lmap = bySeedMap(chocolateSeeds), Rmap = bySeedMap(fruitySeeds);
      function inflate(sideArr, isLeft) {
        const branch = { rounds: [] };
        for (let r = 0; r < sideArr.length; r++) {
          const roundRaw = sideArr[r];
          const matches = roundRaw.map(([a,b]) => [ (a? (isLeft? Lmap.get(a): Rmap.get(a)) : null), (b? (isLeft? Lmap.get(b): Rmap.get(b)) : null) ]);
          branch.rounds.push(matches);
        }
        return branch;
      }
      state.left = inflate(obj.L, true);
      state.right = inflate(obj.R, false);
      state.final = [ obj.F?.[0] ? chocolateSeeds.find(x=>x.seed===obj.F[0]) : null, obj.F?.[1] ? fruitySeeds.find(x=>x.seed===obj.F[1]) : null ];
      state.champion = (obj.C ? ( state.final[0]?.seed===obj.C ? state.final[0] : state.final[1]?.seed===obj.C ? state.final[1] : null ) : null);
      render();
    }

    function saveToHash() {
      const code = encodeState();
      location.hash = code;
    }

    function restoreFromHash() {
      const hash = location.hash.replace('#','');
      if (!hash) return false;
      const ok = decodeState(hash);
      if (ok) render();
      return ok;
    }

    // --- External data loader (?data= URL, ?autorefresh=seconds)
    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    let dataUrl = getParam('data');
    let autoRefreshSec = parseInt(getParam('autorefresh') || '0', 10);
    let refreshTimer = null;

    async function loadExternal() {
      if (!dataUrl) { status('No data URL set'); return; }
      try {
        const res = await fetch(dataUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();
        if (!payload.L || !payload.R) throw new Error('Invalid payload: expected keys L and R');
        applyPayload(payload);
        status('Data loaded');
      } catch (e) {
        console.error(e);
        status('Failed to load data');
      }
    }

    function setupAutoRefresh() {
      if (refreshTimer) clearInterval(refreshTimer);
      if (autoRefreshSec > 0 && dataUrl) {
        refreshTimer = setInterval(loadExternal, autoRefreshSec * 1000);
      }
    }

    // Buttons
    document.getElementById('resetBtn').addEventListener('click', resetBracket);
    document.getElementById('fillRandomBtn').addEventListener('click', randomizeAll);
    document.getElementById('shareBtn').addEventListener('click', () => {
      const code = encodeState();
      navigator.clipboard.writeText(code).then(()=>status('Share code copied')).catch(()=>status('Copy failed'));
    });
    document.getElementById('reloadBtn').addEventListener('click', loadExternal);

    // Init
    initState();
    const restored = restoreFromHash();
    if (!restored) render();

    // If external data URL provided, load and optionally autorefresh
    if (dataUrl) {
      loadExternal();
      setupAutoRefresh();
    }
  </script>
</body>
</html>
